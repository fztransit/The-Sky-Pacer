from AncientAstro.liClass import *
from BasicFunc.timeConvert import *

# Sfl参数：历名, 历元，蔀日，朔旦日法，岁周，中气日法，蔀法，lyjzss=[历元，建正，岁首], bsry=蔀首闰余, lyrgz=历元日干支
# Sfl默认值：lyjzss=['冬至','子','子'], bsry=0，lyrgz='甲子'
# Psl参数：历名, 历元，蔀日，朔旦日法，岁周，蔀法，[章岁，章闰]，df=度法，jys=积元数，bm=[蔀/纪名]
# Psl默认值：df=蔀法，jys=0，bm=['蔀']，lyjzss=['冬至','寅','寅'],
# 各历法参数名称不同，可能混淆，应根据各数据意义填入。本程序中各变量含义：
#   蔀日/朔旦日法=朔策（蔀日可填入朔余）。蔀日或称月法，朔旦日法或称蔀月。
#   四分历：岁周/中气日法=岁实。平朔历：岁周/蔀(纪)法=岁实。（岁周可填入斗分，不用岁差的历法岁周即周天）
#   度法：中气日法，无设定同蔀法
#   章法：朔旦冬至齐同
#   蔀法：夜半朔旦冬至齐同，无小余。蔀名设为'纪'则称纪法（其他名称同理）
#   元法：四分历：历法设定值，其纪法同平朔历之元法
#         平朔历：甲子夜半朔旦冬至齐同（自动计算，无需填入）
#   积元数：近元至上元元数，用来求上元积年
#   关系：(蔀日/朔旦日法)*(章月/章岁)=岁周/中气日法

hdl = Sfl('黄帝历', -1350)
zxl = Sfl('颛顼历', -1506, lyjzss=['立春','寅','亥'], lyrgz='己巳')
xl = Sfl('夏历',    -1076, lyjzss=['雨水','寅','寅'])
rxl = Sfl('真夏历', -1076, lyjzss=['冬至','寅','子'])
yl = Sfl('殷历',    -1567)
zl = Sfl('周历',    -1624)
ll0 = Sfl('鲁历0',  -4881)
ll1 = Sfl('鲁历1',  -2001, bsry=1)
tcl = Psl('太初历', -104, 2392, 81, 562120, 1539, [19,7], df=4617, jys=5120, bm=['统','天','地','人'])
sfl = Sfl('四分历', -1681, lyjzss=['冬至','寅','寅'])
qxl = Psl('乾象历', -104, 43026, 1457, 215130, 589, [19,7], df=2356, jys=6, bm=['纪','内','外'])
jcl = Psl('景初历', -3809, 134630, 4559, 673150, 1843, [19,7], bm=['纪'])
xsl = Psl('玄始历', -61027, 2629759, 89052, 1759, 7200, [600, 221], jf=72000)
yjl = Psl('元嘉历', -5261, 22207, 752, 222070, 608, [19,7], df=304, lyjzss=['雨水','寅','寅'], bm=['纪'])
dml = Psl('大明历', -51477, 116321, 3939, 14423804, 39491, [391,144], bm=['纪'])
zgl = Psl('正光历', -167229, 2213377, 74952, 2213377, 6060, [505,186], jf=60600)
xhl = Psl('兴和历', -293457, 6158017, 208530, 6158017, 16860, [562,207], jf=168600)
tbl = Psl('天保历', -109977, 8641687, 292635, 8641687, 23660, [676,249])
thl = Psl('天和历', -875227, 153991, 290160, 5731, 23460, [391,144])
dxl = Psl('大象历', -40975, 1581749, 53563, 3167, 12992, [448,165])
khl = Psl('开皇历', -4128417, 5372209, 181920, 25063, 102960, [429,158])
dyl = Psl('大业历', -1427037, 33783, 1144, 15573963, 42640, [410,151])
wyl = Dsl('戊寅历', -163723, 384075, 13006, 3456675, 9464, [676,249], 28968, 16064)
ldl = Dsl2('麟德历', -269217, 39571, 1340, 489428, 443077, 12, 67)
dyl2 = Dsl2('大衍历', -96961017, 89773, 3040, 1110343, 6701279, 80, 76)
wjl = Dsl2('五纪历', -269217, 39571, 1340, 489428, 1366156, 37, 67)
zyl = Dsl2('正元历', -402117, 32336, 1095, 399943, 301720132, 10000, 219)
xml = Dsl2('宣明历', -7069317, 248057, 8400, 3068055, 23145819, 100, 84)
cxl = Dsl2('崇玄历', -53946417, 398663, 13500, 4930801, 37198697, 100, 100, sc=160.24)
qtl = Psl2('钦天历', -72697497, 212620.28, 7200, 2629760.4)


lbm = ['汉-太初历', '东汉-四分历', '吴-乾象历', '魏-景初历', '北凉-玄始历', '南朝宋-元嘉历', '南朝梁-大明历', '北魏-正光历',
       '东魏-兴和历', '北齐-天保历', '北周-天和历', '北周-大象历', '隋-开皇历', '隋-大业历', '唐-戊寅历', '唐-麟德历', '唐-大衍历',
	   '唐-五纪历', '唐-正元历', '唐-宣明历', '唐-崇玄历', '后周-钦天历'] #, '宋-应天历', '宋-乾元历', '宋-仪天历'
lb = [hdl, zxl, xl, rxl, zl, yl, ll0, ll1,   # 四分历
      tcl, sfl, qxl, jcl, xsl, yjl, dml, zgl, xhl, tbl, thl, dxl, khl, dyl,  # 平朔历
      wyl, ldl, dyl2, wjl, zyl, xml, cxl, qtl,  # 定朔历
	  ]
tqlb = [None,  # 同期历表
        [yl, zl, ll0, ll1, zxl, hdl, xl, rxl],
        [sfl, qxl, jcl],
        [jcl, yjl, dml, zgl, xhl, tbl, thl, dxl]]
ldlb = {}
for i in range(len(lb)-8):
	ldlb.update({lbm[i]: lb[8+i]})

# 朝代表用历数据
lclf = {'汉': 'BC104-8：太初历',
        '东汉': '25-84：太初历；85-221：四分历',
        '魏': '220-236：四分历；237-265：景初历',
        '蜀汉': '221-263：四分历',
        '吴': '223-280：乾象历',
        '晋': '265-316：泰始历（即景初历）',
        '东晋': '317-420：泰始历（即景初历）',
        '后秦': '284-417：三纪历',
        '北凉': '402-435：玄始历',
        '宋': '420-444：永初历（即景初历）；\n\t445-479：元嘉历',
        '南齐': '479-502：建元历（即元嘉历）',
        '梁': '502-509：元嘉历；510-557：大明历',
        '陈': '557-589：大明历',
        '北魏': '398-451：景初历；452-522：玄始历；\n\t523-534：正光历',
        '东魏': '534-539：正光历；540-550：兴和历',
        '西魏': '535-557：正光历',
        '北齐': '550：兴和历；551-557：天保历',
        '北周': '557-558：正光历；566-578天和历；\n\t579-581：大象历',
        '隋': '581-583：大象历；584-596：开皇历；\n\t597-618：大业历',
        '唐': '618：大业历，619-665：戊寅历；666-728：麟德历；\n\t729-757：大衍历；758-762：至德历；\n\t763-783：五纪历；784-807：正元历；'
             '\n\t808-821：观象历；822-892：宣明历；\n\t893-907：崇玄历',
        '后梁': '907-923：崇玄历',
        '后唐': '908-936：崇玄历',
        '后晋': '936-938：崇玄历；939-943：调元历；944-947：崇玄历',
        '后汉': '947-950：崇玄历',
        '后周': '950-955：崇玄历；956-960：钦天历',
        '北宋': ' 960- 963：钦天历； 964- 982：应天历；\n\t 983-1000：乾元历；1001-1023：仪天历；\n\t1024-1064：崇天历；1065-1067：明天历；'
              '\n\t1068-1074：崇天历；1075-7093：奉元历；\n\t1094-1102：观天历；1103-1105：占天历；\n\t1106-1126：纪元历',
        '南宋': '1127-1167：纪元历；1168-1176：乾道历；\n\t1177-1190：淳熙历；1191-1207：会元历；\n\t1208-1250：开禧历；1251-1252：淳祐历；'
              '\n\t1253-1270：会天历；1271-1276：成天历；\n\t1277-1280：本天历',
        '辽': '947-994：调元历；995-1211：大明历',
        '元': '1281-1267：授时历',
        '明': '1368-1643：大统历（即授时历）',
        '清': '1644-1741：时宪历；1742-7911：癸卯历'}


lclb = [  # [[朝代名，起始年，结束年，历法对象，建正（寅正缺省），历名（缺省）]]
	['汉', [-104, 8, tcl]],
	['新', [9, 23, tcl, 1, '三统历']],
	['更始', [23, 25, tcl]],
	['东汉', [25, 84, tcl], [85, 221, sfl]],
	['魏', [220, 237, sfl, '*'], [237, 239, jcl, 1], [240, 265, jcl]],
	['蜀汉', [221, 263, sfl]],
	['吴', [222, 222, sfl], [223, 280, qxl]],
	['晋', [265, 317, jcl, '泰始历']],
	['东晋', [317, 420, jcl, '泰始历']],
	['宋', [420, 444, jcl, '永初历'], [445, 479, yjl]],
	['南齐', [479, 502, yjl, '建元历']],
	['梁', [502, 509, yjl], [510, 557, dml]],
	['陈', [557, 589, dml]],
	['北魏', [386, 397, jcl, '*'], [398, 451, jcl], [452, 522, xsl], [523, 534, zgl]],
	['东魏', [534, 539, zgl], [540, 550, xhl]],
	['西魏', [535, 557, zgl]],
	['北齐', [550, 550, xhl], [551, 577, tbl]],
	['北周', [556, 558, zgl], [559, 565, zgl, '*'], [566, 578, thl], [579, 581, dxl]],
	['隋', [581, 583, dxl], [584, 596, khl], [597, 618, dyl]],
	['唐', [618, 618, dyl], [619, 665, wyl], [666, 689, ldl], [690, 700, ldl, 0], [701, 728, ldl], [729, 757, dyl2], [758, 761, dyl2, '*至德历'], [762, 762, dyl2, 0, '*至德历'], [763, 783, wjl], [784, 807, zyl], [808, 821, xml, '*观象历'], [822, 892, xml], [893, 907, cxl]],
	['后梁', [907, 923, cxl]],
	['后唐', [923, 936, cxl]],
	['后晋', [936, 938, cxl], [939, 943, xml, '*调元历'], [944, 947, cxl]],
	['后汉', [947, 950, cxl, '**']],
	['后周', [950, 955, cxl, '**'], [956, 960, xml, '*钦天历']],
]

gwxyqk = {'元嘉历': '日本445-696',
			'麟德历': '日本697-763（仪凤历）',
		  '大衍历': '日本764-861（858-861参用五纪历）',
		  '宣明历': '日本862-1684，高丽918-1309？',
		  '授时历': '朝鲜1309？-1392',}


lbxd = {  # 人为修改历表：[年号，年，月，月大小，朔]
	# 1：改历；2：改气朔；3：插入同时修改气朔；4：插入（用后月）；5：删闰月；6：删其他月（未发生）；7：追加（未发生）
	'东汉': [['元和', 85, 1, ['正月小壬午', [8,16,23,10,26]], '太初历'], ['元和', 85, 1, ['二月小辛亥', [9,16,24,12,27]], '太初历']],
	'魏': [['景初', 237, 2, ['四月小戊戌', [8,15,23,12,27]]], ['景初', 239, 4, [1, '后十二月']]],
	'唐': [['神功', 697, 2, ['十月大甲子', [8,15,22,29,13]]], ['神功', 697, 3, ['闰十月大甲午', [8,14,22,[13,'大雪'],['']]], -4],
		  ['神功', 698, 2, ['正月小甲子', [7,14,22,1,[13,'小寒']]]], ['神功', 698, 2, ['腊月小癸巳', [7,15,23,[0,'大寒'], [15,'立春']]]],
		  ['神功', 698, 5, 2+3], ['圣历', 698, 5, 2+3], ['久视', 700, 4, [2, '十一月', '十二月']], ['开元', 724, 3, ['闰十二月大丙辰', [8,15,23,[13,'立春'],['']]], -1],
		  ['开元', 725, 2, ['正月小丙戌', [7,14,22,1,[14,'惊蛰']]]], ['开元', 725, 5, 3+3], ['宝应', 762, 4, [2, '十一月', '十二月']]]
}


# 年号始末表
nhsmb = {  # 朝代：[年号，帝号，[起始年月，终止年月]] * n
	# 表长1：[[起始年月，终止年月]]
	# 表长2：[年号，[起始年月，终止年月]]
	# 表长3：[年号，帝号，[起始年月，终止年月]]
	'汉': [["居摄", [8, 1, 8, 10]], ["初始", [8, 11, 8, 11]]],
	'新': [[[9, 1, 23, 10]]],
	'东汉': [["建武", [25, 6, 56, 3]], ["建武中元", [56, 4, 56, 12]], ["建初", [84, 1, 84, 7]], ["元和", [84, 8, 87, 6]],
	       ["章和", [87, 7, 87, 12]], ["永元", [105, 1, 105, 3]], ["元兴", [105, 4, 105, 12]], ["元初", [120, 1, 120, 3]],
	       ["永宁", [120, 4, 121, 6]], ["建光", [121, 7, 122, 2]], ["延光", '安帝', [122, 3, 125, 3]], ["延光", '少帝', [125, 3, 125, 12]],
	       ["永建", [132, 1, 132, 2]], ["阳嘉", [132, 3, 132, 12]], ["汉安", [144, 1, 144, 3]], ["建康", [144, 4, 144, 12]],
	       ["元嘉", [153, 1, 153, 4]], ["永兴", [153, 5, 153, 12]], ["永寿", [158, 1, 158, 5]], ["延熹", [158, 6, 167, 5]],
	       ["永康", [167, 6, 167, 12]], ["建宁", [172, 1, 172, 4]], ["熹平", [172, 5, 178, 2]], ["光和", [178, 3, 184, 11]],
	       ["中平", '灵帝',[184, 12, 189, 3]], ["光熹", [189, 4, 189, 7]], ["昭宁", [189, 8, 189, 8]], ["永汉", [189, 9, 189, 11]],
	       ["中平", '献帝', [189, 12, 189, 12]], ["建安", [220, 1, 220, 2]], ["延康", [220, 3, 220, 9]] ],
	'更始': [[[23, 1, 25, 9]]],
	'魏': [[[220, 10, 220, 12]], ["太和", [233, 1, 233, 1]], ["青龙", [233, 2, 237, 2]], ["景初", [237, 4, 239, 12]], ["正始", [249, 1, 249, 3]], ["嘉平", [249, 4, 254, 9]],
	      ["正元", [254, 10, 256, 5]], ["甘露", [256, 6, 260, 5]], ["景元", [260, 6, 264, 4]], ["咸熙", [264, 5, 265, 11]]],
	'蜀汉': [["章武",[221,4,223,4]], ['建兴',[223,5,223,12]], ['景耀',[263,1,263,7]], ['炎兴',[263,8,263,11]]],
	'吴': [['黄武',[222,10,229,3]], ['黄龙',[229,4,229,12]], ['嘉禾',[238,1,238,7]], ['赤乌',[238,8,251,4]], ['太元',[251,5,252,1]],
	      ['神凤',[252,2,252,3]], ['建兴',[252,4,252,12]], ['五凤',[256,1,256,9]], ['太平',[256,10,258,9]], ['永安',[258,10,264,6]],
	      ['元兴',[264,7,265,3]], ['甘露',[265,4,266,7]], ['宝鼎',[266,8,269,9]], ['建衡',[269,10,269,12]], ['天册',[276,1,276,6]],
	      ['天玺',[276,7,276,12]], ['天纪',[280,1,280,3]]],
	'晋': [[[265,12,265,12]], ['咸宁',[280,1,280,3]], ['太康',[280,4,280,12]], ['太熙',[290,1,290,3]], ['永熙',[290,4,290,12]],
	      ['永平',[291,1,291,2]], ['元康',[291,3,291,12]], ['永康',[301,1,301,3]], ['永宁',[301,4,302,11]], ['太安',[302,12,302,12]],
	      ['永安',17, [304,1,304,6]], ['建武',[304,7,304,10]], ['永安',19,[304,11,304,11]], ['永兴',[304,12,306,5]], ['光熙',[306,6,306,12]], ['永嘉',[313,1,313,3]], ['建兴',[313,4,317,2]]],
	'东晋': [['建武',[317, 3, 318, 2]], ['太兴', [318, 3, 318, 12]], ['永昌', [323, 1, 323, 2]], ['太宁', [323, 3, 326, 1]],
	       ['咸和', [326, 2, 326, 12]], ['太和', [371, 1, 371, 10]], ['咸安', [371, 11, 371, 12]], [[420, 1, 420, 5]]],
	'北魏': [['登国', [396, 1, 396, 6]], ['皇始', [396, 7, 398,11]], ['天兴', [398, 12, 404, 9]], ['天赐', [404, 10, 409, 9]],
	       ['永兴', [409, 10, 409, 12]], ['神瑞', [416, 1, 416, 3]], ['泰常', [416, 4, 416, 12]], ['始光', [428, 1, 428, 1]],
	       ['神䴥', [428, 2, 428, 12]], ['太延', [440, 1, 440, 5]], ['太平真君', [440, 6, 451, 5]], ['正平', [451, 6, 452, 2]],
	       ['承平', [452, 3, 452, 9]], ['兴安', [452, 10, 454, 6]], ['兴光', [454, 7, 455, 5]], ['太安', [455, 6, 455, 12]],
	       ['天安', [467, 1, 467, 7]], ['皇兴', [467, 8, 471, 7]], ['延兴', [471, 8, 476, 5]], ['承明', [476, 6, 476, 12]],
	       ['正始', [508, 1, 508, 7]], ['永平', [508, 8, 512, 3]], ['延昌', [512, 4, 512, 12]], ['熙平', [518, 1, 518, 1]],
	       ['神龟', [518, 2, 520, 6]], ['正光', [520, 7, 525, 5]], ['孝昌', [525, 6, 525, 12]], ['武泰', [528, 1, 528, 3]],
	       ['建义', [528, 4, 528, 8]], ['永安', [528, 9, 530, 9]], ['建明', [528, 10, 531, 1]], ['普泰', [531, 2, 531, 9]],
	       ['中兴', [531, 10, 532, 3]], ['太昌', [532, 4, 532, 11]], ['永兴', [532, 12, 532, 12]], ['永熙', [532, 12, 532, 12]]],
	'西魏': [[[556,1,556,11]]],
	'东魏': [[[534, 10, 534, 12]], ['元象', [539, 1, 539, 10]], ['兴和', [539, 11, 539, 12]], ['武定', [550, 1, 550, 4]]],
	'北齐': [[[550, 5, 534, 12]], ['乾明', [560, 1, 560, 7]], ['皇建', [560, 8, 561, 10]], ['太宁', [561, 11, 562, 3]],
	       ['河清', [562, 4, 565, 3]], ['天统', [565, 4, 565, 12]], ['武平', [576, 1, 576, 11]], ['隆化', [576, 12, 576, 12]], [[577, 1, 577, 2]]],
	'北周': [['','孝闵帝',[556,12,557,8]], ['','明帝',[557,9,559,7]], ['武成', [559, 8, 559, 12]], ['天和', [572, 1, 572, 2]],
	       ['建德', [572, 3, 578, 2]], ['宣政', [578, 3, 578, 12]], ['大成', [579, 1, 579, 1]], ['大象', [579, 2, 579, 12]], ['大定', [581, 1, 581, 1]]],
	'宋': [[[420,6,420,12]], ['景平',[424,1,424,7]], ['元嘉',[424,8,424,12]], ['永光',[465,1,465,7]], ['景和',[465,8,465,11]],
	      ['泰始',[465,12,465,12]], ['元徽',[477,1,477,6]], ['昇明',[477,7,479,3]]],
	'南齐': [[[479,4,479,12]], ['隆昌',[494,1,494,6]], ['延兴',[494,7,494,9]], ['建武',[494,10,498,3]], ['永泰',[498,4,498,12]],
	      ['永元',[501,1,501,2]], ['中兴',[501,3,502,3]]],
	'梁': [[[502, 4, 502, 12]], ['普通', [527, 1, 527, 2]], ['大通', [527, 3, 529, 9]], ['中大通', [529, 10, 529, 12]],
	       ['大同', [546, 1, 546, 3]], ['中大同', [546, 4, 547, 3]], ['太清', [547, 4, 547, 12]], ['大宝', [551, 1, 551, 7]],
	      ['天正', '豫章王',[551, 8, 552, 10]], ['天正', '武陵王',[552, 4, 552, 4]], ['承圣', [552, 11, 555, 4]], ['天成', [555, 5, 555, 9]], ['绍泰', [555, 10, 556, 8]], ['太平', [556, 9, 557, 9]]],
	'陈': [[[557, 10, 557, 12]], ['天嘉', [566, 1, 566, 1]], ['天康', [566, 2, 566, 12]], ['祯明', [589, 1, 589, 1]]],
	'隋': [[[581,2,581,12]], ['大业', [617,1,617,10]], ['义宁', [617,11,618,2]], ['大业', [618,3,618,4]], ['皇泰', [618,5,618,5]]],
	'唐': [[[618,5,618,12]], ['显庆',[661,1,661,2]],['龙朔',[661,3,661,12]], ['乾封',[668,1,668,2]],['总章',[668,3,670,2]],
		  ['咸亨',[670,3,674,7]],['上元',[674,8,676,10]],['仪凤',[676,11,679,5]],['调露',[679,6,680,7]],['永隆',[680,8,681,8]],
		  ['开耀',[681,9,682,1]], ['永淳',[682,2,683,11]], ['弘道',[683,12,683,12]], ['嗣圣',[684,1,684,1]], ['文明',[684,2,684,8]],
		  ['光宅',[684,9,684,12]], ['永昌',[689,1,689,10]], ['载初',[690,1,690,10]], ['天授',[690,11,692,5]], ['如意',[692,6,692,11]],
		  ['长寿',[692,11,694,7]],['延载',[694,7,695,2]], ['证圣',[695,3,695,11]], ['天册万岁',[695,11,696,2]], ['万岁登封',[696,2,696,5]],
		  ['万岁通天',[696,5,697,11]],['神功',[697,11,698,2]],['圣历',[698,3,700,7]],['久视',[700,7,701,1]],['大足',[701,1,701,10]],
		  ['长安',[701,10,705,1]],['神龙','（武周）',[705,1,705,1]],['神龙','中宗',[705,1,707,8]],['景龙',[707,9,710,5]],
		  ['唐隆',[710,6,710,6]],['景云',[710,7,711,12]],['太极',[712,1,712,4]],['延和',[712,5,712,7]],['先天',[712,8,713,11]],
		  ['开元',[713,12,713,12]],['天宝',[756,1,756,6]],['至德',[756,7,758,1]],['乾元',[758,2,760,4,'**']],['上元',[760,4,761,10,'*']],
		  ['',[761,9,761,10]],['',[762,1,762,3]],['宝应',[762,4,763,6]],['广德',[763,7,763,12]],['永泰',[766,1,766,10]],['大历',[766,11,766,12]],
		  ['贞元',[805,1,805,7]],['永贞',[805,8,805,12]],['宝历',[827,1,827,1]],['太和',[827,2,827,12]],['大中',[860,1,860,10]],
		  ['咸通',[860,11,874,10]],['乾符',[874,11,874,12]],['庆明',[881,1,881,6]],['中和',[881,7,885,2]],['光启',[885,3,888,1]],
		  ['文德',[888,2,888,12]],['乾宁',[898,1,898,7]],['光化',[898,8,901,3]],['天复',[901,4,904,4,'**']],['天祐','昭宗',[904,4,904,7,'*']],['天祐','哀帝',[904,8,907,3]]],
	'后梁': [['开平',[907,4,911,4]],['乾化','太祖',[911,5,911,12]],['凤历',[913,1,913,1]],['乾化','末帝',[913,2,915,10]],['贞明',[915,12,921,4]],['龙德',[921,5,923,3]]],
	'后唐': [['同光',[923,4,926,3]],['天成',[926,4,930,1]],['长兴',[930,2,930,12]],['应顺',[934,1,934,3]],['清泰',[934,4,936,10]]],
	'后晋': [['天福', '高祖',  [936, 1, 942, 5]], ['天福', '出帝', [942, 6, 944, 6]], ['开运', [944, 7, 947, 1]]],
	'后汉': [['天福', [947, 2, 947, 12]], ['乾祐', '高祖', [948, 1, 948, 1]], ['乾祐', '隐帝', [948, 2, 950, 12]] ],
	'后周': [['显德', '太祖', [954, 1, 954, 1]], ['显德', '世宗', [954, 1, 959, 5]], ['显德', '恭帝', [959, 6, 959, 12]]],

}


